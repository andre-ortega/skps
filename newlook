#!/usr/bin/env bash

RED='\033[0;31m'
RESET='\033[0m'
set -eou pipefail

# LOAD SAVE
#wall=sara_white.png
#wall=graffiti

WALL_DIR=/home/roe/pix/wall
SKPS_DIR=/home/roe/skps/custom_walz

# Prioritize command-line arg
if  [[ $# -eq 1 ]]; then
  wall=$1
  node_name=$1
# If no save, randomize
elif [ -z ${wall+x} ]; then
  node_name=$(ls -1 ~/pix/wall/ | shuf -n 1)
  wall=$WALL_DIR/$node_name
# Else execute save
else
  wall=$WALL_DIR/$wall
fi

# Add this as background wallpaper
xwallpaper --zoom $wall

# Clear
wal -c

echo -e "-------------------> ${RED}WALL: $node_name${RESET}"
echo -e "-------------------> ${RED}$SKPS_DIR/$node_name.json${RESET}"

if [[ -f "$SKPS_DIR/$node_name.json" ]]; then
  echo -e "${RED}FILE REACHED.${RESET}"
else
  echo -e "${RED}404 FILE NOT FOUND${RESET}"
fi

if wal -a 92 -f "$SKPS_DIR/$node_name.json"; then
  echo -e "${RED}CUSTOM SCHEME APPLIED${RESET}"
else
  wal -a 92 -i $wall
  echo -e "${RED}Generated Colorscheme${RESET}"
fi

if [[ ! -z $(pgrep polybar) ]]; then
  killall -9 polybar
  sleep 1;
fi

MONITOR=eDP-1 polybar center --config=$HOME/.config/polybar/config.ini &
MONITOR=HDMI-1 polybar secondary-center --config=$HOME/.config/polybar/config.ini &
